10 STX$=Asc(2):ETX$=Asc(3):EOT$=Asc(4):ENQ$=Asc(5):ACK$=Asc(6):BEL$=Asc(7)
12 US$=Asc(31):RD$=Asc(250):WR$=Asc(251)
15 Xon$=Asc(17):Xoff$=Asc(19):Xoff=0
20 OPEN "COM0: 4,N,8,1" AS #1
30 CLS
40 PRINT#1,ENQ$;
50 IF INPUT$(1,#1)<>STX$ THEN PRINT "COMUNICACION IMPOSIBLE":GOTO 500
60 'Recepcion de un bloque
70 GOSUB 1000:Ch$=INPUT$(1,#1)
80 IF Ch$=ETX$ THEN 200
90 IF Ch$=BEL$ THEN BEEP:GOTO 60
100 IF Ch$=RD$ THEN GOSUB 3000:GOTO 200
110 IF Ch$=WR$ THEN GOSUB 4000:GOTO 200
150 PRINT Ch$;:GOTO 60
200 'Emisi¢n de caracteres
205 Ch$="":FOR Pausa=1 TO 50
210 IF Ch$="" THEN Ch$=INKEY$
220 NEXT Pausa:GOSUB 2000
230 IF Ch$="" THEN PRINT#1,ACK$; ELSE PRINT#1,Ch$;
240 GOSUB 1000:Ch$=INPUT$(1,#1)
250 IF Ch$=STX$ THEN 60
260 IF Ch$=BEL$ THEN BEEP:GOTO 200
270 IF Ch$=ACK$ THEN 200
280 IF Ch$=EOT$ THEN 500
290 PRINT Ch$;:GOTO 200
500 PRINT"FIN DE LA TRANSMISION":CLOSE#1:END
1000 'Rutina control envio XON/XOFF
1010 IF (LOF(1)<100)AND(Xoff=0) THEN PRINT#1,Xoff$;:Xoff=1
1020 IF (LOF(1)>223)AND(Xoff=1) THEN PRINT#1,Xon$;:Xoff=0
1030 RETURN
2000 'Rutina recepci¢n XON/XOFF
2010 IF LOF(1)>0 THEN MSSG$=INPUT$(1,#1)
2020 IF MSSG$<>Xoff$ THEN 2050
2030 GOTO 2010
2050 RETURN
3000 'Petici¢n lectura fichero
3010 Name$=""
3020 GOSUB 1000:Ch$:=INPUT$(1,#1)
3030 IF Ch$=ETX$ THEN 3050
3040 Name$=Name$+Ch$:GOTO 3020
3050 OPEN Name$ FOR OUTPUT AS#2
3060 PRINT#1,STX$;
3070 Ch$=INPUT$(1,#2):GOSUB 2000:PRINT#1,Ch$;
3080 IF NOT EOF(2) THEN 3070
3090 CLOSE#2:PRINT#1,ETX$;:RETURN
4000 'Petici¢n escritura fichero
4010 Name$=""
4020 GOSUB 1000:Ch$:=INPUT$(1,#1)
4030 IF Ch$=US$ THEN 4050
4040 Name$=Name$+Ch$:GOTO 4020
4050 OPEN Name$ FOR INPUT AS#2
4060 GOSUB 1000:Ch$=INPUT$(1,#1)
4070 IF Ch$=ETX$ THEN 4100
4080 PRINT#2,Ch$;:GOTO 4060
4100 CLOSE#2:RETURN
